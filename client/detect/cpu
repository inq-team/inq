#!/bin/sh
# NAME=CPU detect
# DESCRIPTION=Detect CPUs using /proc/cpuinfo.
# DEPENDS=CPU

IFS=":	"

fix_vendor() {
	echo "${@# }" | sed 's/Genuine//g; s/Authentic//g;'
}

fix_model() {
	echo $@ | sed \
	-e 's/(R)//g' \
	-e 's/(tm)//g' \
	-e 's/processor//ig' \
	-e 's/CPU//g' \
	-e 's/Intel//g' \
	-e 's/AMD//g' \
	-e 's/Genuine/Core Solo/' \
	-e 's/@ //' \
	-e 's/  */ /g' \
	-e 's/^ *//g'
}

while read key val; do
	case "$key" in
	# single-cores don't have "core id"
	"processor") core=0;;
	"core id") core="${val# }";;
	"vendor_id") vendor="$val";;
	"model name") model="$val";;
	"") [ "$core" = 0 ] && \
	    add_component CPU \
	    "`fix_vendor $vendor`" \
	    "`fix_model $model`" \
	    "" "";;
	esac
done < /proc/cpuinfo
